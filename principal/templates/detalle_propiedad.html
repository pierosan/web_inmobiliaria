{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load l10n %}

{% block content %}

<!-- Galería principal de imágenes -->
<section class="prop-gallery-top">
  <div class="gallery-row container">
    {% for img in propiedad.imagenes.all %}
      <div class="gallery-item">
        <img src="{{ img.imagen_url }}" alt="{{ propiedad.nombre }}">
      </div>
    {% endfor %}
  </div>
</section>

<!-- Cabecera -->
<section class="prop-head container">
  <div class="prop-head-left">
    <h1 class="prop-title">{{ propiedad.nombre }}</h1>
    <p class="prop-address">
      <i class="fas fa-map-marker-alt"></i>
      {{ propiedad.direccion }}
    </p>
  </div>
  <div class="prop-head-right">
    <div class="prop-price">S/ {{ propiedad.precio|floatformat:3 }}</div>
    <p class="prop-address">
      <i class="fas fa-ruler-combined"></i>
      {{ propiedad.area_m2 }} m²
    </p>
  </div>
</section>

<!-- Descripción + resumen -->
<section class="prop-body container">
  <div class="prop-desc">
    <h3>Descripción</h3>
    <p>{{ propiedad.descripcion }}</p>
  </div>
</section>

<!-- Dirección + detalles -->
<section class="prop-info container">
  <div class="info-left card">
    <h3>Dirección del Inmueble</h3>
    <p><strong>Ciudad:</strong> {{ propiedad.ciudad }}</p>
    <p><strong>Distrito:</strong> {{ propiedad.distrito }}</p>
    <p><strong>Dirección:</strong> {{ propiedad.direccion }}</p>
    <a href="{{ propiedad.ubicacion_url  }}" target="_blank" class="btn-map">
      <i class="fas fa-map"></i> Abrir en Google Maps
    </a>
  </div>

  <div class="info-right card">
    <h3>Detalles de la Propiedad</h3>
    <ul>
          <li><strong>Nombre:</strong> {{ propiedad.nombre }}</li>
          <li><strong>Descripción:</strong> {{ propiedad.descripcion }}</li>
          <li><strong>Precio:</strong> S/ {{ propiedad.precio|floatformat:2 }}</li>
          <li><strong>Área:</strong> {{ propiedad.area_m2 }} m²</li>
          <li><strong>Latitud:</strong> {{ propiedad.latitud }}</li>
          <li><strong>Longitud:</strong> {{ propiedad.longitud }}</li>
          <li><strong>Ciudad:</strong> {{ propiedad.ciudad }}</li>
          <li><strong>Distrito:</strong> {{ propiedad.distrito }}</li>
          <li><strong>Dirección:</strong> {{ propiedad.direccion }}</li>
          <li><strong>URL Ubicación:</strong> <a href="{{ propiedad.ubicacion_url }}" target="_blank">Ver mapa</a></li>
          {% if propiedad.video %}
          <li><strong>Video:</strong> <a href="{{ propiedad.video }}" target="_blank">Ver video</a></li>
          {% endif %}
          <li><strong>Agregado el:</strong> {{ propiedad.creado_en }}</li>
    </ul>
  </div>
</section>

<!-- Video -->
{% if propiedad.video %}
<section class="prop-video container">
  <h3>Video del Inmueble</h3>
  <div class="video-wrapper">
    <iframe
      width="100%" height="450"
      src="{{ propiedad.video }}"
      title="Video del inmueble"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen
      referrerpolicy="strict-origin-when-cross-origin">
    </iframe>

  </div>
</section>
{% endif %}

<!-- Mapa -->
<section class="prop-map container">
  <h3>Ubicación en el mapa</h3>
  <div class="map-wrapper">
    <iframe width="425" height="350" src="https://www.openstreetmap.org/export/embed.html?bbox={{ propiedad.longitud|unlocalize }}%2C{{ propiedad.latitud|unlocalize }}%2C{{ propiedad.longitud|unlocalize }}%2C{{ propiedad.latitud|unlocalize }}&amp;layer=mapnik&amp;marker={{ propiedad.latitud|unlocalize }}%2C{{ propiedad.longitud|unlocalize }}" style="border: 1px solid black"></iframe>
  </div>
</section>

{% endblock %}
